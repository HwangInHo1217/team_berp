<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì…ê³  ê´€ë¦¬</title>
  <!-- âœ… Bootstrap CSS/JS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="d-flex flex-column" style="min-height: 100vh;">
<!-- ê³µí†µ í—¤ë” -->
<div th:replace="~{/layouts/header :: header}"></div>
  <div class="d-flex flex-grow-1">
    <!-- ê³µí†µ ì‚¬ì´ë“œë°” -->
	<div th:replace="~{/layouts/sidebar :: sidebar}"></div>
    <main class="p-4 flex-fill">
      <div class="container">
        <h2 class="mb-4">ì…ê³  ê´€ë¦¬</h2>

        <!-- ğŸ” ê²€ìƒ‰ì°½ + ë²„íŠ¼ í•œ ì¤„ ì •ë ¬ -->
        <div class="d-flex flex-wrap gap-2 align-items-center mb-3">
          <input type="text" class="form-control w-auto" placeholder="í’ˆëª©ëª…" />
          <input type="date" class="form-control w-auto" />
          <span class="align-self-center">~</span>
          <input type="date" class="form-control w-auto" />
          <select class="form-select w-auto">
            <option>ì „ì²´ ì°½ê³ </option>
            <option>ìì¬ì°½ê³  A</option>
            <option>ì™„ì œí’ˆì°½ê³ </option>
          </select>
          <select class="form-select w-auto" id="statusFilter">
            <option value="ALL">ì „ì²´ ìƒíƒœ</option>
            <option value="TEMP">ê°€ì…ê³ </option>
            <option value="CONFIRMED">ì‹¤ì…ê³ </option>
          </select>
          <button class="btn btn-outline-secondary">ê²€ìƒ‰</button>

          <!-- âœ… ìš°ì¸¡ ë²„íŠ¼ë“¤ -->
          <button class="btn btn-outline-success ms-auto" onclick="alert('ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ì€ ì¶”í›„ ì œê³µë  ì˜ˆì •ì…ë‹ˆë‹¤.')">ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
          <button class="btn btn-danger" onclick="deleteSelectedRows()">ì‚­ì œ</button>
          <button class="btn btn-success" onclick="confirmSelectedRows()">ì‹¤ì…ê³  ì „í™˜</button>
          <button class="btn btn-primary" onclick="openReceiveAddModal()" data-bs-toggle="modal" data-bs-target="#receiveRegisterModal">+ ì…ê³  ë“±ë¡</button>
        </div>

        <!-- ğŸ“‹ ì…ê³  í…Œì´ë¸” -->
        <div class="table-responsive">
          <table class="table table-bordered text-center align-middle" id="receiveTable">
            <thead class="table-light">
              <tr>
                <th><input type="checkbox" /></th>
                <th>ìˆœë²ˆ</th>
                <th>ì…ê³ ì¼ì</th>
                <th>ë§¤ì…ì²˜</th>
                <th>í’ˆëª©ì½”ë“œ</th>
                <th>í’ˆëª©ëª…</th>
                <th>ìˆ˜ëŸ‰</th>
                <th>ë‹¨ìœ„</th>
                <th>ì°½ê³ </th>
                <th>ì…ê³ ìœ í˜•</th>
                <th>ë‹´ë‹¹ì</th>
                <th>ì…ê³ ìƒíƒœ</th>
                <th>ë¹„ê³ </th>
                <th>ìƒì„¸</th>
                <th>ìˆ˜ì •</th>
              </tr>
            </thead>
            <tbody>
              <tr data-status="TEMP">
                <td><input type="checkbox" /></td>
                <td>1</td>
                <td>2025-05-18</td>
                <td>ë§¤ì…ì²˜íšŒì‚¬ì´ë¦„</td>
                <td>M001</td>
                <td>ìì¬ A</td>
                <td>100</td>
                <td>EA</td>
                <td>ìì¬ì°½ê³  A</td>
                <td>êµ¬ë§¤ì…ê³ </td>
                <td>ê¹€ì¸í˜¸</td>
                <td>ê°€ì…ê³ </td>
                <td>-</td>
                <td>
                  <!-- ğŸ” ìƒì„¸ ë²„íŠ¼ -->
                  <button class="btn btn-info btn-sm" onclick="openReceiveDetailModal({
                    date: '2025-05-18',
                    company_id : 'ë§¤ì…ì²˜íšŒì‚¬ì´ë¦„',
                    itemCode: 'M001',
                    itemName: 'ìì¬ A',
                    quantity: 100,
                    unit: 'EA',
                    warehouse: 'ìì¬ì°½ê³  A',
                    type: 'êµ¬ë§¤ì…ê³ ',
                    status: 'ê°€ì…ê³ ',
                    manager: 'ê¹€ì¸í˜¸',
                    note: '-'
                  })">ìƒì„¸</button>
                </td>
                <td>
                  <!-- âœï¸ ìˆ˜ì • ë²„íŠ¼ -->
                  <button class="btn btn-warning btn-sm" onclick="openReceiveEditModal({
                    id: 1,
                    date: '2025-05-18',
                    company_id: 'ë§¤ì…ì²˜íšŒì‚¬ì´ë¦„',
                    item_id: '1',
                    qty: 100,
                    unit: 'EA',
                    warehouse_id: '1',
                    type: 'PURCHASE',
                    status: 'TEMP',
                    manager: 'ê¹€ì¸í˜¸',
                    note: '-'
                  })">ìˆ˜ì •</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <!-- ê³µí†µ í‘¸í„° -->
  <div th:replace="~{/layouts/footer :: footer}"></div>
  <div id="receiveModals"></div>
  <div id="receiveDetailModals"></div>

<!-- âœ… ëª¨ë‹¬, ë ˆì´ì•„ì›ƒ íŒŒì¼ fetch + ìë°”ìŠ¤í¬ë¦½íŠ¸ -->
<script>
  // ğŸ“¦ ê³µí†µ ë ˆì´ì•„ì›ƒ ë¶ˆëŸ¬ì˜¤ê¸°
  fetch('/layouts/header.html').then(res => res.text()).then(html => document.getElementById('header').innerHTML = html);
  fetch('/layouts/sidebar.html').then(res => res.text()).then(html => document.getElementById('sidebar').innerHTML = html);
  fetch('/layouts/footer.html').then(res => res.text()).then(html => document.getElementById('footer').innerHTML = html);

  // ğŸ§¾ ë“±ë¡ ëª¨ë‹¬
  fetch('/pages/receive/receive-register-modal.html')
    .then(res => res.text())
    .then(html => document.getElementById('receiveModals').innerHTML = html);

  // ğŸ” ìƒì„¸ ëª¨ë‹¬
  fetch('/pages/receive/receive-detail-modal.html')
    .then(res => res.text())
    .then(html => document.getElementById('receiveDetailModals').innerHTML = html);
</script>

<script>
  // âœï¸ ìˆ˜ì • ëª¨ë“œë¡œ ëª¨ë‹¬ ì—´ê¸°
  function openReceiveEditModal(data) {
    document.getElementById('receiveDate').value = data.date;
    document.getElementById('companyId').value = data.company_id;
    document.getElementById('itemId').value = data.item_id;
    document.getElementById('quantity').value = data.qty;
    document.getElementById('unit').value = data.unit;
    document.getElementById('warehouseId').value = data.warehouse_id;
    document.getElementById('receiveType').value = data.type;
    document.getElementById('receiveStatus').value = data.status;
    document.getElementById('manager').value = data.manager;
    document.getElementById('note').value = data.note;
    document.getElementById('submitBtn').textContent = 'ìˆ˜ì •';
    document.getElementById('receiveForm').action = `/receive/update/${data.id}`;
    new bootstrap.Modal(document.getElementById('receiveRegisterModal')).show();
  }

  // â• ë“±ë¡ ëª¨ë“œ ì´ˆê¸°í™”
  function openReceiveAddModal() {
    document.getElementById('receiveForm').reset();
    document.getElementById('submitBtn').textContent = 'ë“±ë¡';
    document.getElementById('receiveForm').action = '/receive/add';
  }

  // ğŸ—‘ ì‚­ì œ ê¸°ëŠ¥
  function deleteSelectedRows() {
    const checkboxes = document.querySelectorAll('tbody input[type="checkbox"]:checked');
    if (checkboxes.length === 0) return alert('ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
    if (!confirm(`${checkboxes.length}ê±´ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
    checkboxes.forEach(cb => cb.closest('tr').remove());
    alert('ì‚­ì œ ì™„ë£Œ');
  }

  // ğŸ”„ ì‹¤ì…ê³  ì „í™˜
  function confirmSelectedRows() {
    const rows = document.querySelectorAll('tbody input[type="checkbox"]:checked');
    if (rows.length === 0) return alert('ê°€ì…ê³  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
    rows.forEach(cb => {
      const row = cb.closest('tr');
      row.querySelector('td:nth-child(11)').textContent = 'ì‹¤ì…ê³ ';
      row.setAttribute('data-status', 'CONFIRMED');
    });
    alert('ì„ íƒëœ í•­ëª©ì´ ì‹¤ì…ê³ ë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.');
  }

  // ğŸ“¤ ìƒíƒœ í•„í„°ë§
  document.getElementById('statusFilter').addEventListener('change', function () {
    const value = this.value;
    document.querySelectorAll('#receiveTable tbody tr').forEach(row => {
      const rowStatus = row.getAttribute('data-status');
      row.style.display = (value === 'ALL' || rowStatus === value) ? '' : 'none';
    });
  });

  // ğŸ§¹ ëª¨ë‹¬ ë‹«í ë•Œ ì´ˆê¸°í™”
  window.addEventListener('DOMContentLoaded', () => {
    const modalEl = document.getElementById('receiveRegisterModal');
    if (modalEl) {
      modalEl.addEventListener('hidden.bs.modal', () => {
        document.getElementById('receiveForm').reset();
        document.getElementById('submitBtn').textContent = 'ë“±ë¡';
        document.getElementById('receiveForm').action = '/receive/add';
      });
    }
  });

  // ğŸ” ìƒì„¸ ë³´ê¸° ëª¨ë‹¬ ì—´ê¸°
  function openReceiveDetailModal(data) {
    document.getElementById('detailDate').textContent = data.date;
    document.getElementById('detailCompany').textContent = data.company_id;
    document.getElementById('detailItemCode').textContent = data.itemCode;
    document.getElementById('detailItemName').textContent = data.itemName;
    document.getElementById('detailQty').textContent = data.quantity;
    document.getElementById('detailUnit').textContent = data.unit;
    document.getElementById('detailWarehouse').textContent = data.warehouse;
    document.getElementById('detailType').textContent = data.type;
    document.getElementById('detailStatus').textContent = data.status;
    document.getElementById('detailManager').textContent = data.manager;
    document.getElementById('detailNote').textContent = data.note;
    new bootstrap.Modal(document.getElementById('receiveDetailModal')).show();
  }
</script>
</body>
</html>
