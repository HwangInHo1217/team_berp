<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ìƒì‚°ê³„íš ê´€ë¦¬</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="d-flex flex-column" style="min-height: 100vh;">
  <div id="header"></div>
  <div class="d-flex flex-grow-1">
    <div id="sidebar"></div>
    <main class="p-4 flex-fill">
      <div class="container">
        <h2 class="mb-4">ìƒì‚°ê³„íš ê´€ë¦¬</h2>
        
        <!-- ğŸ” ê²€ìƒ‰ ë° ë²„íŠ¼ ì˜ì—­ -->
        <div class="d-flex flex-wrap gap-2 align-items-center mb-3">
          <input type="date" class="form-control w-auto" placeholder="ê³„íšì¼ì" />
          <span>~</span>
          <input type="date" class="form-control w-auto" placeholder="ê³„íšì¼ì" />
          <input type="text" class="form-control w-auto" placeholder="í’ˆëª©ëª…/ì½”ë“œ" />
          <button class="btn btn-outline-secondary">ê²€ìƒ‰</button>
          <button class="btn btn-outline-success ms-auto">ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
          <button class="btn btn-primary" onclick="openPlanAddModal()" data-bs-toggle="modal" data-bs-target="#planRegisterModal">+ ìƒì‚°ê³„íš ë“±ë¡</button>
        </div>
        
        <!-- ğŸ“‹ ìƒì‚°ê³„íš í…Œì´ë¸” -->
        <div class="table-responsive">
          <table class="table table-bordered text-center align-middle">
            <thead class="table-light">
              <tr>
                <th><input type="checkbox" /></th>
                <th>ê³„íšë²ˆí˜¸</th>
                <th>ê³„íšì¼ì</th>
                <th>í’ˆëª©ì½”ë“œ</th>
                <th>í’ˆëª©ëª…</th>
                <th>ê³„íšìˆ˜ëŸ‰</th>
                <th>ë‹¨ìœ„</th>
                <th>ë‚©ê¸°ì¼</th>
                <th>ìƒì‚°ìƒíƒœ</th>
                <th>ë‹´ë‹¹ì</th>
                <th>ë¹„ê³ </th>
                <th>ìƒì„¸</th>
                <th>ìˆ˜ì •</th>
                <th>ì‚­ì œ</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><input type="checkbox" /></td>
                <td>PP202405001</td>
                <td>2025-05-23</td>
                <td>P001</td>
                <td>ì™„ì œí’ˆ A</td>
                <td>1000</td>
                <td>EA</td>
                <td>2025-06-01</td>
                <td>ê³„íš</td>
                <td>ê¹€ì¸í˜¸</td>
                <td>-</td>
                <td><button class="btn btn-info btn-sm" onclick="openPlanDetailModal({
                  plan_no: 'PP202405001',
                  plan_date: '2025-05-23',
                  item_code: 'P001',
                  item_name: 'ì™„ì œí’ˆ A',
                  quantity: 1000,
                  unit: 'EA',
                  due_date: '2025-06-01',
                  status: 'ê³„íš',
                  manager: 'ê¹€ì¸í˜¸',
                  note: '-'
                })">ìƒì„¸</button></td>
                <td> <button class="btn btn-warning btn-sm"
				      onclick='openPlanEditModal({
				        id: 1,
				        plan_date: "2025-06-01",
				        item_code: "P001",
				        item_name: "ì™„ì œí’ˆA",
				        quantity: 500,
				        unit: "EA",
				        due_date: "2025-06-10",
				        status: "ê³„íš",
				        manager: "ê¹€ì¸í˜¸",
				        note: "ì‹œì œí’ˆ ìš°ì„ "
				      })'>ìˆ˜ì •</button></td>
                <td><button class="btn btn-danger btn-sm" onclick="alert('ì‚­ì œ ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ ì˜ˆì •')">ì‚­ì œ</button></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </div>
  <div id="footer"></div>
  
  <!-- ëª¨ë‹¬ ì˜ì—­ -->
  <div id="planRegisterModalWrapper"></div>
  <div id="planDetailModalWrapper"></div>

  <!-- ê³µí†µ fetch -->
  <script>
    fetch('/layouts/header.html').then(res => res.text()).then(html => document.getElementById('header').innerHTML = html);
    fetch('/layouts/sidebar.html').then(res => res.text()).then(html => document.getElementById('sidebar').innerHTML = html);
    fetch('/layouts/footer.html').then(res => res.text()).then(html => document.getElementById('footer').innerHTML = html);
    fetch('/pages/plan/plan-register-modal.html').then(res => res.text()).then(html => document.getElementById('planRegisterModalWrapper').innerHTML = html);
    fetch('/pages/plan/plan-detail-modal.html').then(res => res.text()).then(html => document.getElementById('planDetailModalWrapper').innerHTML = html);
  </script>
  <script>
    // ìƒì„¸ ëª¨ë‹¬ ì˜¤í”ˆ í•¨ìˆ˜ (í•„ìš”ì— ë”°ë¼ ì‹¤ì œ ë°ì´í„° ì—°ë™)
    function openPlanDetailModal(data) {
      if (!document.getElementById('planDetailModal')) {
        fetch('/pages/plan/plan-detail-modal.html')
          .then(res => res.text())
          .then(html => {
            document.getElementById('planDetailModalWrapper').innerHTML = html;
            setTimeout(() => openPlanDetailModal(data), 100);
          });
        return;
      }
      document.getElementById('planDetailPlanNo').textContent = data.plan_no;
      document.getElementById('planDetailPlanDate').textContent = data.plan_date;
      document.getElementById('planDetailItemCode').textContent = data.item_code;
      document.getElementById('planDetailItemName').textContent = data.item_name;
      document.getElementById('planDetailQuantity').textContent = data.quantity;
      document.getElementById('planDetailUnit').textContent = data.unit;
      document.getElementById('planDetailDueDate').textContent = data.due_date;
      document.getElementById('planDetailStatus').textContent = data.status;
      document.getElementById('planDetailManager').textContent = data.manager;
      document.getElementById('planDetailNote').textContent = data.note;
      const modal = new bootstrap.Modal(document.getElementById('planDetailModal'));
      modal.show();
    }
    // ë“±ë¡, ìˆ˜ì • ëª¨ë‹¬ í•¨ìˆ˜ëŠ” ì¶”í›„ êµ¬í˜„ (register, edit)
    function openPlanAddModal() {
      if (!document.getElementById('planRegisterModal')) return;
      document.getElementById('planForm').reset();
      document.getElementById('planForm').action = '/plan/add';
      document.getElementById('submitBtn').textContent = 'ë“±ë¡';
    }
    function openPlanEditModal(data) {
    	  // ëª¨ë‹¬ì´ ì•„ì§ ë¡œë”©ë˜ì§€ ì•Šì•˜ë‹¤ë©´ fetch í›„ ì¬í˜¸ì¶œ
    	  if (!document.getElementById('planRegisterModal')) {
    	    fetch('/pages/plan/plan-register-modal.html')
    	      .then(res => res.text())
    	      .then(html => {
    	        document.body.insertAdjacentHTML('beforeend', html);
    	        setTimeout(() => openPlanEditModal(data), 100); // ëª¨ë‹¬ ì‚½ì… í›„ ì¬í˜¸ì¶œ
    	      });
    	    return;
    	  }

    	  // ê°’ ì£¼ì…
    	  document.getElementById('planDate').value = data.plan_date;
    	  document.getElementById('itemCode').value = data.item_code;
    	  document.getElementById('itemName').value = data.item_name;
    	  document.getElementById('quantity').value = data.quantity;
    	  document.getElementById('unit').value = data.unit;
    	  document.getElementById('dueDate').value = data.due_date;
    	  document.getElementById('status').value = data.status;
    	  document.getElementById('manager').value = data.manager;
    	  document.getElementById('note').value = data.note || '';

    	  // í¼ action ë° ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
    	  document.getElementById('planForm').action = `/plan/update/${data.id}`;
    	  document.getElementById('submitBtn').textContent = 'ìˆ˜ì •';

    	  // ëª¨ë‹¬ ì—´ê¸°
    	  const modal = new bootstrap.Modal(document.getElementById('planRegisterModal'));
    	  modal.show();
    	}
  </script>
</body>
</html>
