<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì¶œê³  ê´€ë¦¬</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="d-flex flex-column" style="min-height: 100vh;">

  <!-- âœ… ê³µí†µ ë ˆì´ì•„ì›ƒ ì‚½ì… ì˜ì—­ -->
  <div id="header"></div>
  <div class="d-flex flex-grow-1">
    <div id="sidebar"></div>

    <!-- âœ… ë³¸ë¬¸ ì˜ì—­ -->
    <div class="container py-4">
      <h2 class="mb-4">ì¶œê³  ê´€ë¦¬</h2>

      <!-- ğŸ” ê²€ìƒ‰ + ë²„íŠ¼ -->
      <div class="d-flex flex-wrap gap-2 align-items-center mb-3">
        <input type="text" class="form-control w-auto" placeholder="í’ˆëª©ëª…" />
        <input type="date" class="form-control w-auto" />
        <span class="align-self-center">~</span>
        <input type="date" class="form-control w-auto" />
        <select class="form-select w-auto">
          <option>ì „ì²´ ì°½ê³ </option>
          <option>ìì¬ì°½ê³  A</option>
          <option>ì™„ì œí’ˆì°½ê³ </option>
        </select>
        <button class="btn btn-outline-secondary">ê²€ìƒ‰</button>

        <button class="btn btn-outline-success ms-auto">ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
        <button class="btn btn-danger">ì‚­ì œ</button>
        <button class="btn btn-primary" onclick="openShipmentAddModal()" data-bs-toggle="modal" data-bs-target="#shipmentRegisterModal">
          + ì¶œê³  ë“±ë¡
        </button>
      </div>

      <!-- ğŸ“‹ ì¶œê³  í…Œì´ë¸” -->
      <div class="table-responsive">
        <table class="table table-bordered text-center align-middle">
          <thead class="table-light">
            <tr>
              <th><input type="checkbox" /></th>
              <th>ìˆœë²ˆ</th>
              <th>ì¶œê³ ì¼ì</th>
              <th>ê³ ê°ì‚¬ëª…</th>
              <th>í’ˆëª©ì½”ë“œ</th>
              <th>í’ˆëª©ëª…</th>
              <th>ìˆ˜ëŸ‰</th>
              <th>ë‹¨ìœ„</th>
              <th>ì°½ê³ </th>
              <th>ë‹´ë‹¹ì</th>
              <th>ë¹„ê³ </th>
              <th>ìƒì„¸</th>
              <th>ìˆ˜ì •</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><input type="checkbox" /></td>
              <td>1</td>
              <td>2025-05-18</td>
              <td>ì‚¼ì„±ì „ì</td>
              <td>P001</td>
              <td>ì™„ì œí’ˆ A</td>
              <td>200</td>
              <td>EA</td>
              <td>ì™„ì œí’ˆì°½ê³ </td>
              <td>ê¹€ì¸í˜¸</td>
              <td>-</td>
              <td>
                <button class="btn btn-info btn-sm"
                  onclick="openShipmentDetailModal({
                    date: '2025-05-18',
                    customer: 'ì‚¼ì„±ì „ì',
                    itemCode: 'P001',
                    itemName: 'ì™„ì œí’ˆ A',
                    quantity: 200,
                    unit: 'EA',
                    warehouse: 'ì™„ì œí’ˆì°½ê³ ',
                    manager: 'ê¹€ì¸í˜¸',
                    note: '-'
                  })">ìƒì„¸</button>
              </td>
              <td>
                <button class="btn btn-warning btn-sm"
                  onclick="openShipmentEditModal({
                    id: 1,
                    date: '2025-05-18',
                    customer_id: '1',
                    item_id: 'P001',
                    quantity: 200,
                    unit: 'EA',
                    warehouse_id: '1',
                    manager: 'ê¹€ì¸í˜¸',
                    note: '-'
                  })">ìˆ˜ì •</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- âœ… ëª¨ë‹¬ ì‚½ì…ìš© div -->
  <div id="shipmentModals"></div> <!-- ë“±ë¡/ìˆ˜ì • ëª¨ë‹¬ -->
  <div id="shipmentDetailModalWrapper"></div> <!-- ìƒì„¸ ëª¨ë‹¬ -->
  <div id="footer"></div>

  <!-- âœ… ê³µí†µ ë ˆì´ì•„ì›ƒ fetch -->
  <script>
    fetch('/layouts/header.html').then(res => res.text()).then(data => document.getElementById('header').innerHTML = data);
    fetch('/layouts/sidebar.html').then(res => res.text()).then(data => document.getElementById('sidebar').innerHTML = data);
    fetch('/layouts/footer.html').then(res => res.text()).then(data => document.getElementById('footer').innerHTML = data);
  </script>

  <!-- âœ… ìƒì„¸ ëª¨ë‹¬ fetch ë° ì—´ê¸° -->
  <script>
    function openShipmentDetailModal(data) {
      fetch('/pages/shipment/shipment-detail-modal.html')
        .then(res => res.text())
        .then(html => {
          document.getElementById('shipmentDetailModalWrapper').innerHTML = html;
          document.getElementById('shipmentDetailDate').textContent = data.date;
          document.getElementById('shipmentDetailCustomer').textContent = data.customer;
          document.getElementById('shipmentDetailItemCode').textContent = data.itemCode;
          document.getElementById('shipmentDetailItemName').textContent = data.itemName;
          document.getElementById('shipmentDetailQty').textContent = data.quantity;
          document.getElementById('shipmentDetailUnit').textContent = data.unit;
          document.getElementById('shipmentDetailWarehouse').textContent = data.warehouse;
          document.getElementById('shipmentDetailManager').textContent = data.manager;
          document.getElementById('shipmentDetailNote').textContent = data.note;

          const modal = new bootstrap.Modal(document.getElementById('shipmentDetailModal'));
          modal.show();
        });
    }
  </script>

  <!-- âœ… ë“±ë¡/ìˆ˜ì • ëª¨ë‹¬ fetch ë° ë™ì‘ í•¨ìˆ˜ -->
  <script>
    fetch('/pages/shipment/shipment-register-modal.html')
      .then(res => res.text())
      .then(html => {
        document.getElementById('shipmentModals').innerHTML = html;

        // ëª¨ë‹¬ì´ ë‹«í ë•Œ ê¸°ë³¸ ìƒíƒœë¡œ ì´ˆê¸°í™”
        const modalEl = document.getElementById('shipmentRegisterModal');
        if (modalEl) {
          modalEl.addEventListener('hidden.bs.modal', () => {
            document.getElementById('shipmentForm').reset();
            document.getElementById('shipmentForm').action = '/shipment/add';
            document.getElementById('submitBtn').textContent = 'ë“±ë¡';
          });
        }
      });

    // ë“±ë¡ ëª¨ë“œ
    function openShipmentAddModal() {
      document.getElementById('shipmentForm').reset();
      document.getElementById('shipmentForm').action = '/shipment/add';
      document.getElementById('submitBtn').textContent = 'ë“±ë¡';
    }

    // ìˆ˜ì • ëª¨ë“œ
    function openShipmentEditModal(data) {
      document.getElementById('shipmentDate').value = data.date;
      document.getElementById('customerId').value = data.customer_id;
      document.getElementById('itemId').value = data.item_id;
      document.getElementById('quantity').value = data.quantity;
      document.getElementById('unit').value = data.unit;
      document.getElementById('warehouseId').value = data.warehouse_id;
      document.getElementById('manager').value = data.manager;
      document.getElementById('note').value = data.note;

      document.getElementById('shipmentForm').action = `/shipment/update/${data.id}`;
      document.getElementById('submitBtn').textContent = 'ìˆ˜ì •';

      const modal = new bootstrap.Modal(document.getElementById('shipmentRegisterModal'));
      modal.show();
    }
  </script>
</body>
</html>
